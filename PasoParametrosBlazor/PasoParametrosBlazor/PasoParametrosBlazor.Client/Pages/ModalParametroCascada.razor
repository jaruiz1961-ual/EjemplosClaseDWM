@page "/modalParametroCascada"
@using PasoParametrosBlazor.Client.Components
@rendermode InteractiveWebAssembly

<button @onclick="MostrarModal">Mostrar modal con parametro</button>
<input @bind="dato" />

@if (modalVisible)
{
    <CascadingValue Value="dato" Name="ValorEntrada">
        <CascadingValue Value="(Action)CerrarModal" Name="Cerrar" >
            <CascadingValue Value="(Action)GuardarModal" Name="Guardar">
            <CascadingValue Value="inx" Name="Indice">
            @if (inx == 1)
            {
                    <MiModalParametroCascada ValorEditadoChanged="@ActualizarDato1" Ultimo=false />
            }

            @if (inx == 2)
            {
                    <MiModalParametroCascada ValorEditadoChanged="@ActualizarDato2" Ultimo=false />
            }

            @if (inx == 3)
            {
                    <MiModalParametroCascada ValorEditadoChanged="@ActualizarDato3" Ultimo=true />
            }

            </CascadingValue>
        </CascadingValue>
    </CascadingValue>
    </CascadingValue>
}

@code {
    ClaseDato dato = new ClaseDato();
    bool modalVisible = false;
    int inx = 0;

    async Task ActualizarDato1(ClaseDato nuevoValor)
    {
        dato.Valor1 = nuevoValor.Valor1;
    }
    async Task ActualizarDato2(ClaseDato nuevoValor)
    {
        dato.Valor2 = nuevoValor.Valor2;
    }
    async Task ActualizarDato3(ClaseDato nuevoValor)
    {
        dato.Valor3 = nuevoValor.Valor3;
    }

    void MostrarModal() 
    {
        inx = 1;
        modalVisible = true;
    }
    void GuardarModal()
    {
        inx++;
        if (inx == 4) modalVisible = false;
    }
    void CerrarModal()
    {
        inx = 0;
        modalVisible = false;
    }

    public class ClaseDato
    {
        public string Valor1 { get; set; }
        public string Valor2 { get; set; }
        public string Valor3 { get; set; }
    }
}

